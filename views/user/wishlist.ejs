<!DOCTYPE html>
<html lang="en">


<!-- molla/wishlist.html  22 Nov 2019 09:55:05 GMT -->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Molla - Bootstrap eCommerce Template</title>
    <meta name="keywords" content="HTML5 Template">
    <meta name="description" content="Molla - Bootstrap eCommerce Template">
    <meta name="author" content="p-themes">
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/icons/favicon-16x16.png">
    <link rel="manifest" href="assets/images/icons/site.html">
    <link rel="mask-icon" href="assets/images/icons/safari-pinned-tab.svg" color="#666666">
    <link rel="shortcut icon" href="assets/images/icons/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Molla">
    <meta name="application-name" content="Molla">
    <meta name="msapplication-TileColor" content="#cc9966">
    <meta name="msapplication-config" content="assets/images/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <!-- Plugins CSS File -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- Main CSS File -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div class="page-wrapper">
        <header class="header">
            <div class="header-top">
                <div class="container">
                    <div class="header-left">
                        <div class="header-dropdown">
                            <a href="#">Usd</a>
                            <div class="header-menu">
                                <ul>
                                    <li><a href="#">Eur</a></li>
                                    <li><a href="#">Usd</a></li>
                                </ul>
                            </div>
                        </div>

                        <div class="header-dropdown">
                            <a href="#">Eng</a>
                            <div class="header-menu">
                                <ul>
                                    <li><a href="#">English</a></li>
                                    <li><a href="#">French</a></li>
                                    <li><a href="#">Spanish</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="header-right">
                        <ul class="top-menu">
                            <li>
                                <a href="#">Links</a>
                                <ul>
                                    <% if (isLoggedIn) { %>
                                        <li><a href="/my-account/details"><i class="icon-user"></i>My Account</a></li>
                                    <% } else { %>
                                        <li><a href="/login"><i class="icon-user"></i>Login</a></li>
                                    <% } %>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <%- include('../partials/navbar') %>

            

            
        </header>

        <main class="main">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">Wishlist<span>Shop</span></h1>
        		</div>
        	</div>
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Wishlist</li>
                    </ol>
                </div>
            </nav>

            <div class="page-content">
            	<div class="container">
					<table class="table table-wishlist table-mobile">
						<thead>
							<tr>
								<th>Product</th>
								<th>Price</th>
								<th>Stock Status</th>
								<th></th>
								<th></th>
							</tr>
						</thead>

						<tbody>
                            <% products.forEach(product => { %>
                            <tr>
                                <td class="product-col">
                                    <div class="product">
                                        <figure class="product-media">
                                            <a href="/product/<%= product._id %>">
                                                <img src="/<%= product.images[0]%>" alt="<%= product.name %>">
                                                <%= console.log(product.images) %>
                                            </a>
                                        </figure>
                                        <h3 class="product-title">
                                            <a href="#"><%= product.name %></a>
                                        </h3>
                                    </div>
                                </td>
                                <td class="price-col">
                                    <% if (product.offer) { %>
                                        <span style="color: red;">Rs.<%= product.discountPrice %></span>
                                        <span style="text-decoration: line-through; color: #777; margin-left: 10px;">Rs.<%= product.price %></span>
                                    <% } else { %>
                                        Rs.<%= product.price %>
                                    <% } %>
                                </td>
                                
                                <td class="stock-col">
                                    <span class="<%= product.stock > 0 ? 'in-stock' : 'out-of-stock' %>">
                                        <%= product.stock > 0 ? 'In stock' : 'Out of stock' %>
                                    </span>
                                </td>
                                <td class="action-col">
                                    <% if (product.stock > 0) { %>
                                        <button class="btn btn-block btn-outline-primary-2 btn-cart"
                                        data-product-id="<%= product._id %>" 
                                        data-product-price="<%= product.isOnSale ? product.salePrice : product.price %>">
                                         <i class="icon-cart-plus"></i>Add to Cart
                                        </button>
                                    <% } else { %>
                                        <button class="btn btn-block btn-outline-primary-2 disabled">Out of Stock</button>
                                    <% } %>
                                </td>
                                <td class="remove-col">
                                    <button class="btn-remove" data-product-id="<%= product._id %>">
                                        <i class="icon-close"></i>
                                    </button>
                                </td>
                            </tr>
                            <% }); %>
                        </tbody>
                        
					</table>
            	</div>
            </div>
        </main>

        <%- include('../partials/footer') %>

        
    </div>
    <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

    

    <!-- Plugins JS File -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery.hoverIntent.min.js"></script>
    <script src="assets/js/jquery.waypoints.min.js"></script>
    <script src="assets/js/superfish.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>
</body>



</html>


<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script>
    document.querySelectorAll('.btn-cart').forEach(button => {
        button.addEventListener('click', function (event) {
            event.preventDefault();

            const productId = this.getAttribute('data-product-id');
            const price = this.getAttribute('data-product-price');
            const userId = '<%= userId %>';
            
            if (!productId || !price) {
                Swal.fire('Error', 'Invalid product details.', 'error');
                return;
            }

            axios.post('/add-to-cart', {
                userId: userId,
                productId: productId,
                price: price
            })
                .then(response => {
                    Swal.fire('Success!', 'Product has been added to your cart.', 'success');
                })
                .catch(error => {
                    console.error('Error adding product to cart:', error);
                    Swal.fire('Oops!', 'Something went wrong!', 'error');
                });
        });
    });
</script>


<!--removing item  -->
<script>
    document.querySelectorAll(".btn-remove").forEach(button =>{
        button.addEventListener("click" , function (event){
           event.preventDefault()
            const productId = this.getAttribute("data-product-id")


            axios.post("/removeWishlist",{productId}).then(resposne =>{
                Swal.fire("item removed succesfully")

                this.closest('tr').remove();
            }).catch(error=>{
                Swal.fire('Oops!', 'Something went wrong!', 'error');
            })
        })
    })
</script>

